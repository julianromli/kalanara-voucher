# Supabase Keep-Alive Setup Guide\n\nDokumentasi lengkap untuk mencegah Supabase database ter-pause setelah 7 hari tidak aktif.\n\n## ğŸ¯ Overview\n\nPlatform ini menggunakan **4 layer protection** untuk memastikan Supabase tetap aktif:\n\n1. **Database Heartbeat** (every 6 hours) - Primary internal solution\n2. **Edge Function Cron** (every 6 hours) - Serverless ping mechanism  \n3. **GitHub Actions** (weekly) - External backup solution\n4. **Manual Monitoring** - Dashboard oversight\n\n## ğŸ› ï¸ Implementation Status\n\nâœ… **Completed:**\n- [x] Database heartbeat table dan function\n- [x] Edge Function `keep-alive` deployed\n- [x] Cron schedule untuk Edge Function (every 6 hours)\n- [x] GitHub Actions workflow\n- [x] Automated cleanup for old records\n\n## ğŸ“Š Monitoring\n\n### Check Database Activity\n\n```sql\n-- Lihat semua ping activity\nSELECT \n  source,\n  last_ping,\n  created_at,\n  EXTRACT(EPOCH FROM (NOW() - created_at))/3600 as hours_ago\nFROM keep_alive \nORDER BY created_at DESC \nLIMIT 10;\n\n-- Cek cron jobs yang sedang aktif\nSELECT * FROM cron.job ORDER BY jobname;\n\n-- Lihat execution history\nSELECT * FROM cron.job_run_details ORDER BY start_time DESC LIMIT 10;\n```\n\n### Supabase Dashboard Monitoring\n\n1. **Database > Tables > keep_alive** - Monitor ping records\n2. **Edge Functions > keep-alive** - Check function logs\n3. **Logs > Database** - Monitor cron job execution\n\n## ğŸ”§ Manual Operations\n\n### Test Keep-Alive Function\n\n```bash\n# Via curl\ncurl -X POST \"https://kginxwtmcdvqbnwmlctw.supabase.co/functions/v1/keep-alive\" \\\n  -H \"Authorization: Bearer YOUR_ANON_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"source\": \"manual_test\", \"timestamp\": \"'$(date -Iseconds)'\"}'\n```\n\n### Manual Heartbeat\n\n```sql\n-- Manual trigger heartbeat function\nSELECT heartbeat();\n\n-- Manual insert record\nINSERT INTO keep_alive (source) VALUES ('manual_trigger');\n```\n\n### Disable/Enable Cron Jobs\n\n```sql\n-- List semua cron jobs\nSELECT jobname, schedule, active FROM cron.job;\n\n-- Disable specific job\nSELECT cron.unschedule('keep-alive-edge-function');\nSELECT cron.unschedule('heartbeat-6hours');\n\n-- Re-enable jobs (if needed)\nSELECT cron.schedule(\n  'keep-alive-edge-function',\n  '0 */6 * * *',\n  'SELECT net.http_post(url := \"https://kginxwtmcdvqbnwmlctw.supabase.co/functions/v1/keep-alive\", headers := jsonb_build_object(\"Content-Type\", \"application/json\", \"Authorization\", \"Bearer \" || current_setting(\"app.settings.service_role_key\", true)), body := jsonb_build_object(\"source\", \"cron_schedule\", \"timestamp\", now()));'\n);\n```\n\n## ğŸš¨ Troubleshooting\n\n### Common Issues\n\n**1. Edge Function Not Called**\n```sql\n-- Check if cron job exists and is active\nSELECT * FROM cron.job WHERE jobname = 'keep-alive-edge-function';\n\n-- Check execution history\nSELECT * FROM cron.job_run_details WHERE jobname = 'keep-alive-edge-function' ORDER BY start_time DESC LIMIT 5;\n```\n\n**2. Function Returns Error**\n- Check Edge Function logs in Supabase Dashboard\n- Verify service role key is set correctly\n- Ensure function has proper permissions\n\n**3. Database Paused Anyway**\n- Run manual heartbeat: `SELECT heartbeat();`\n- Trigger GitHub Actions workflow manually\n- Contact Supabase support if issue persists\n\n### Logs Location\n\n- **Database Logs:** Supabase Dashboard > Logs > Database\n- **Edge Function Logs:** Supabase Dashboard > Edge Functions > keep-alive > Logs\n- **GitHub Actions:** Repository > Actions tab\n\n## ğŸ”’ Security Notes\n\n- Service role key digunakan untuk Edge Function (server-side only)\n- Anon key digunakan untuk GitHub Actions (client-safe)\n- All cron jobs menggunakan secure HTTP headers\n- Database access dibatasi via RLS policies\n\n## ğŸ“ˆ Expected Behavior\n\nDengan setup ini, Supabase database akan:\n\n1. **Tetap aktif 24/7** - Heartbeat setiap 6 jam\n2. **Zero manual intervention** - Fully automated\n3. **Multiple fallbacks** - Jika satu layer gagal, ada backup\n4. **Comprehensive logging** - Semua activity tercatat\n\n## ğŸ†˜ Emergency Procedures\n\nJika Supabase tetap ter-pause:\n\n1. **Immediate Action:**\n   ```sql\n   SELECT heartbeat();\n   ```\n\n2. **Force GitHub Actions:**\n   - Go to repository Actions tab\n   - Run \"Keep Supabase Active\" workflow manually\n\n3. **Check Service Status:**\n   - Supabase Status Page\n   - Database connectivity\n\n4. **Contact Support:**\n   - Supabase Discord\n   - GitHub Issues untuk platform ini\n\n## ğŸ“ Maintenance\n\n**Weekly:**\n- Check GitHub Actions execution logs\n- Verify database heartbeat records\n\n**Monthly:**\n- Review old keep_alive records (auto-cleanup runs weekly)\n- Test manual procedures\n\n**Quarterly:**\n- Update GitHub Actions dependencies\n- Review cron schedule effectiveness\n- Assess Supabase usage patterns\n\n---\n\n*Last Updated: 2025-12-15*\n*Version: 1.0*
